---
title: "YOUR TITLE HERE"
subtitle: "STAT 231: Calendar Query"
author: "Sebastian Montesinos"
date: "Last updated \\today"
output: pdf_document
---

```{r setup, include = FALSE}
# load packages
library(tidyverse)
library(lubridate)
library(ical)

# set code chunk defaults
knitr::opts_chunk$set(tidy = F, # display code as typed
                      size = "small", # slightly smaller code font
                      message = FALSE,
                      warning = FALSE,
                      comment = "\t") 

# set black & white default plot theme 
# theme_set(theme_classic()) # uncomment this line if desired

# improve digit and NA display 
options(scipen = 1, knitr.kable.NA = '')
```

<!--
HOW TO USE THIS TEMPLATE:

The template is designed to help you structure your report. All work herein should be your own. Thus, you should write your own code comments, set your own chunk options, etc. You should clean up code comments that I've left so they are useful for you. 

You can leave the markdown comments for guidance in writing your report since they will not appear in the knitted pdf. If you like, you can remove them. 

Please rename/remove the headings as you see fit. 
You may add subheadings as desired to break up the report. Practice your Markdown formatting to make a professional looking report. 

REMINDERS ABOUT FILE ORGANIZATION AND GITHUB:
You should commit and push all relevant files to GitHub. Someone else (me, in particular) should be able to download the *calendar-query* folder from GitHub and run your .Rmd file without changing anything (meaning file paths are not specific to your computer and all files that are read in are provided.)

Your final *calendar-query* project folder should be organized such that file names and any subfolder names are informative, making relevant content easy to find for someone with little or no context of the project (i.e., if someone saw a file called "calendar_report_template" they would likely assume it was a template and *not* and not a finalized report). 
-->

# Introduction 

<!--
Describe the questions of interest: what are they and why are they important or useful to you?


The second question I address is how the amount of time I spend on work in a day relates to the amount of personal time I take during a day. One might expect that since the more time I spend on one activity the less time there is for the other, there will be a simple negative correlation. However, I have noticed that I sometimes give myself more time for recreational activities when I have done a lot of work as a 'reward', and spend more time on independent academic projects or looking for jobs when I do not spend a lot of time on work in a day since I feel guilty if I am not productive in a day. Therefore, it could also be the case that as I spent more time on schoolwork I also take more personal time, making the two positively correlated. I was also interested in how this relationship might change on weekdays vs weekends, since I try to give myself more of a break during the weekends.

-->

# Data collection 

<!--
Briefly describe your data collection process, including how you defined variables of interest (include the levels/categories of categorical variables and the units for quantitative variables).
--> 
I coded my data into three broad categories: 'work', for anything related to school (ie. class and homework), 'personal' for anything related to recreation (ie. gaming, seeing friends) and 'extracurricular' for any work outside of class (ie. job applications, clubs, independent projects). I decided to code the work category as four subcategories corresponding to my four classes: data science, oceanography, religion, and my thesis. I decided not to further divide the other two categories since my questions did not require doing so. So, in the end, I had six ways I marked off time on my calendar: 4 for my classes, 1 for personal time, and 1 for extracurricular. The units for all of these categories were in time, specifically minutes spent on each activity, which I used google calendar to code in.


<!--
The code below is provided as a starting point for importing an `ics` file into R as a dataframe, doing some initial wrangling, and adding up the time spent on each activity. You are not required to use this code, but I hope it is useful as you get started. Feel free to delete or modify it as you see fit. 

If you are using the code, be sure to update the capitalized parts with the relevant path to where your `ics` file is located *relative to where this Rmd file is located in the repo*, and set `eval = TRUE`.

NOTE: All of your wrangling should be in this file - preferably well-organized and in one place if possible. You may use multiple chunks if it makes it easier to tell your narrative. This is demo-ed below, where the data is wrangled first for one visualization, then could be used for the second, etc. 
-->

```{r import-wrangle, eval = TRUE}
# Data import and preliminary wrangling
calendar_data <- "SMontesinosCalendarQuery.ics" %>% 
  ## Use ical package to import into R
  ical_parse_df() %>% 
  ## Convert to "tibble" data frame format
  as_tibble() %>% 
  ## calendar event descriptions are in a variable called "summary"
  ## "activity" is a more relevant/informative variable name
  rename(activity = summary) %>% 
  mutate(
    ## Specify time zone (defaults to UTC otherwise)
    start_datetime = with_tz(start, tzone = "America/New_York"),
    end_datetime = with_tz(end, tzone = "America/New_York"),
    ## Compute duration of each activity in hours
    ## Feel free to use minutes instead
    duration = interval(start_datetime, end_datetime) / hours(1),
    ## Convert text to lower case and trim spaces to help clean up
    ## potential inconsistencies in formatting
    activity = str_to_lower(activity),
    ## separate date from time
    date = floor_date(start_datetime, unit = "day"),
    ## Examples of ways to parse dates, times (keep only what you need!)
    year = year(date),
    month = month(date, label = FALSE),
    day = day(date),
    day_of_week = wday(date, label = TRUE),
    day_of_year = yday(date)) %>% 
  ## remove spurious year (added to every Google calendar)
  filter(year != 1969) %>%
  ## Turning the date variable into a date type
  mutate(date = ymd(date)) %>%
  ## Including only dates after I started collecting for the project
  filter(year >= 2022 & month >= 2 & day >= 17) %>%
  ##Removing trailing whitespace
  mutate(activity = str_trim(activity)) %>%
  ##Replacing spaces with underscores in activity names 
  mutate(activity = str_replace(activity, " ", "_")) %>%
  ##Creating another column that records whether the observation was made on the weekday or weekend
  mutate(week_status = case_when(day_of_week == "Sat" | day_of_week == "Sun" ~ "Weekend", 
                                 TRUE ~ "Weekday"))

```

<!--
Briefly describe and justify your plans for analysis (i.e., visualizations and summary table). Which graphs and corresponding visual cues do you plan to use? Which summary measures will you use in your table? (This will likely be a less detailed version of what you submitted for your proposal.) The idea is to let your reader know what is coming before they get to it. 
--> 


```{r vis1-prep, eval = TRUE}
# Example of preparing dataset for first visualization

# Computing total duration for each activity per day of the week
activities_total <- calendar_data %>% 
  group_by(date, day_of_week, activity) %>%
  summarize(duration = sum(duration),
#Including number of total observations
            ) %>%
  pivot_wider(names_from = activity, values_from = duration)

#Filling in 
activities_total[is.na(activities_total)] = 0

activities_average <- activities_total %>%
  group_by(day_of_week) %>%
  summarise(DS_Average = mean(data_science), 
            O_Average = mean(oceanography), 
            R_Average = mean(religion),
            T_Average = mean(thesis)) %>%
  pivot_longer(-day_of_week, 
               names_to = "Activity",
               values_to = "Duration")


```

```{r vis2-prep, eval = TRUE}
# Preparing dataset for second visualization


activities_comparison <- calendar_data %>%
#Selecting relevant variables
  select(day, activity, duration, week_status) %>% 
# Adding a unique row identifier so I can pivot
  mutate(row = row_number()) %>%
# Pivoting wider to get each activity by day
  pivot_wider(names_from = activity, values_from = duration) %>%
# Dropping row identifier
  select(-row) 
#replacing NA values with 0s
activities_comparison[is.na(activities_comparison)] = 0

# Grouping by day and summing the activity duration into categories I want to compare
activities_comparison2 <- activities_comparison %>%
  group_by(day, week_status) %>%
# Calculating total school work time, personal time, and extracurricular time
  summarise(work_time = sum(thesis, oceanography, religion, data_science), personal_time = sum(personal), extracurricular_time = sum(extracurriculars))
# 




```


# Results 

<!--
You may organize your results however you see fit (e.g., one subsection for each question or one subsection for each visualization/table). 

Each visualization and table should have its own code chunk. 

Before each code chunk, describe what information is conveyed through the corresponding visualization or table in connection with the questions you posed (e.g., "The first figure captures how the time I spent on each class varied over the two-week period. It appears I spent the most time on..."). 
-->


<!--
Describe what information is conveyed through your first data visualization (that you'll create below).
-->


```{r}
# Code for first data visualization
# Be sure to provide meaningful title and axes labels and
# resize figure appropriately
# Only code for your first visualization should be here (no or very minimal wrangling code)
# Remove all these comments!
p <- ggplot(data = activities_average, aes(x=day_of_week, y = DS_Average)) +
  geom_line()

p

```

<!--
Describe what information is conveyed through your second data visualization (that you'll create below).
-->


```{r}
#Plotting total work time against personal time per day
n <- ggplot(data = activities_comparison2, aes(x= work_time, y = personal_time)) +
#Creating 1 plot for weekends and one for weekdays
  facet_wrap(~week_status, nrow = 1) +
#Using points to represent each day
  geom_point() +
#Labeling the graph
  labs(title = "Time spent on work vs Recreation per day",
       y = "Personal time (hours)",
       x = "Schoolwork time (hours)")
n
```

<!--
Describe what information is conveyed through the table (that you'll create) below. Again, the order is up to you. Move these around so they make sense for your analysis!
-->


```{r, results = 'asis'}
# Code for table
# Only code for your table should be here (no or very minimal wrangling code)
```

# Conclusions 

<!--
With your initial questions in mind, briefly summarize what you learned about how you spent your time. What are the big take-aways for you about how you spend your time? If relevant, how does this affect how you might spend your time going forward?
-->


\newpage


# Reflection 

<!--
Write your reflection here in paragraph form. In particular, address...

* What difficulties in the data collection and analysis process did you encounter?  Identify two of your main hurdles in gathering accurate data.
* What implications do those difficulties have for future data collection and/or analysis projects if you were to repeat this project? 
* Did you have enough data? How much data do you think you'd need to collect in order to satisfactorily answer your question(s) of interest? Would it be hard to collect that data? Why or why not?
* As someone who provides data, what expectations do you have when you give your data (e.g. to Facebook, Google, MapMyRun, etc.)?  
* As someone who analyzes others' data, what ethical responsibilities do you have?

You may address these questions in any particular order. If it helps, you can make a subsection for each. 
-->
